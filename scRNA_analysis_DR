# Please view README

# Libraries
import scanpy as sc
import anndata as ad
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# Load highly variable filtered data
adata = sc.read_h5ad("adata_hvg.h5ad")

# Regress out variations in data for plotting
sc.pp.regress_out(adata, ["total_counts", "pct_counts_MT", "pct_counts_RIBO", "pct_counts_HB"])

# Scale data for proper PCA
sc.pp.scale(adata, max_value=10)
sc.tl.pca(adata, svd_solver="arpack")

# PCA for dimensionality reduction
sc.pl.pca_variance_ratio(adata, n_pcs=20, log=True)

#Plot PCA colored by QC metrics: mitochondrial, ribosomal, and hemoglobin gene percentages.
def plot_pca_qc(adata):
  sc.pl.pca(adata, color=['pct_counts_MT', 'pct_counts_RIBO', 'pct_counts_HB'])
    
plot_pca_qc(adata))
    
# Create nearest neighbours (similar cells)
sc.pp.neighbors(adata)
sc.tl.umap(adata)

# Clustering cells using the Leiden algorithm.
sc.tl.leiden(adata, resolution = 0.5)

# Visualise
sc.pl.umap(
    adata,
    color="leiden",
    size=8,
    legend_loc="on data",
    frameon=False
)





how to map clusters from adata_hvg.obs["leiden"] to adata_full.obs.









